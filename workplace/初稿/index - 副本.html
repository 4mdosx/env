<!DOCTYPE HTML>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<title>结伴广场</title>

		<link href="styles/style.css" rel="stylesheet" type="text/css">
		<link href="styles/font-awesome.css" rel="stylesheet" type="text/css">

		<script type="text/javascript" src="scripts/jquery.js"></script>
		<script type="text/javascript" src="scripts/framework.plugins.js"></script>
		<script type="text/javascript" src="scripts/custom.js"></script>

	</head>

	<body>
		<div id="preloader">
			<div id="status">
				<p class="center-text">
					正在加载...
				</p>
			</div>
		</div>

		<div class="all-elements">

			<!-- Sidebar-->
			<div class="snap-drawers">
				<div class="snap-drawer snap-drawer-left">
					<div class="sidebar-header">
						<a href="#" class="sidebar-logo"></a>
						<a href="#" class="sidebar-close"><i class="fa fa-times"></i></a>
					</div>
					<div class="sidebar-breadcrumb">
						校区
					</div>
					<ul class="sidebar-menu">
						<li>
							<a href="index.html"><i class="fa fa-arrows"></i>本部<i class="fa fa-last fa-circle"></i></a>
						</li>
                        <li>
							<a href="index.html"><i class="fa fa-arrows-h"></i>海韵<i class="fa fa-last fa-circle"></i></a>
						</li>
                        <li>
							<a href="index.html"><i class="fa fa-arrows-alt"></i>翔安<i class="fa fa-last fa-circle"></i></a>
						</li>
                        <li>
							<a href="index.html"><i class="fa fa-hand-o-up"></i>不限<i class="fa fa-last fa-circle"></i></a>
						</li>
					</ul>
					<div class="sidebar-breadcrumb">
						结伴
					</div>
					<ul class="sidebar-menu">
						<li id="sidebar-login"><a href="login.html"><i class="fa fa-support"></i>运动<i class="fa fa-last fa-circle"></i></a>
						</li>
						<li id=""><a href="post.html"><i class="fa fa-book"></i>学习<i class="fa fa-last fa-circle"></i></a>
						</li>
						<li id=""><a href="manage.html"><i class="fa fa-coffee"></i>美食<i class="fa fa-last fa-circle"></i></a>
						</li>
                        <li id=""><a href="manage.html"><i class="fa fa-car"></i>出行<i class="fa fa-last fa-circle"></i></a>
						</li>
                        <li id=""><a href="manage.html"><i class="fa fa-cubes"></i>其他<i class="fa fa-last fa-circle"></i></a>
						</li>
					</ul>
				
				</div>
			</div>

			<!-- Page Content-->
			<div id="content" class="snap-content">
				<div class="header">
					<a href="javascript:;" class="open-nav"><i class="fa fa-navicon"></i></a>
					<a href="javascript:;" id="searchButton" class="open-socials"><i class="fa fa-search"></i></a>
					<a href="index.html" class="header-logo"></a>
				</div>

				<div id="search" class="commentsFormWrapper hide">
					<div class="commentsForm" id="commentsForm">
						<div class="formFieldWrapper" style="float: left; width: 76%;margin-left: 2%; margin-right: 2%;">
							<input placeholder="请输入要搜索的内容" type="text" name="keyword" id="keyword" />
						</div>
						<input type="submit" class="buttonWrapper commentSubmitButton" style="width: 16%; margin-left: 2%; margin-right: 2%;" id="commentSubmitButton" value="搜索" />
					</div>
				</div>

				<div class="content">
					<div class="notification-page">
						<div id="list"></div>
						<div id="more"><a href="javascript:;" class="button button-blue center-button">加载更多</a>
						</div>
					</div>
				</div>

				<div class="footer">
					<p class="center-text">
						Copyright 2016.
						<br> 结伴？？？
					</p>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			(function($) {

				$(document).ready(function() {

					function getCookie(c_name) {
						if (document.cookie.length > 0) {
							c_start = document.cookie.indexOf(c_name + "=")
							if (c_start != -1) {
								c_start = c_start + c_name.length + 1
								c_end = document.cookie.indexOf(";", c_start)
								if (c_end == -1) c_end = document.cookie.length
								return unescape(document.cookie.substring(c_start, c_end))
							}
						}
						return ""
					}

					$('#searchButton').click(function() {
						$("#search").toggleClass("hide");
					});

					var page = 0;
					var loadpage = function() {
						$.getJSON("Operation.php?oper=list&&page=" + page, function(s) {
							var ahtml = '';
							$.each(s.list, function(k, v) {
								ahtml += '<p class="notification-page-item" id="' + v.p_heartid + '">';
								ahtml += v.p_top == 1 ? '<img class="top" src="images/top.png" alt="top" />' : ' ';
								ahtml += v.p_finish == 1 ? '<img class="done" src="images/done.png" alt="done" />' : ' ';
								ahtml += '<img src="' + 'images/head.jpg' + '" alt="img" /><em>' + v.p_content + '</em><a href="#" class="pickHeart">';
								ahtml += v.isPick == 1 ? '<span class="fa fa-star" />&nbsp;已摘&nbsp;(' + v.p_pick + ')' : '<span class="fa fa-star-o" />&nbsp;摘&nbsp;(' + v.p_pick + ')';
								ahtml += '</a><a href="#" class="goodHeart">';
								ahtml += v.isGood == 1 ? '<span class="fa fa-thumbs-up" />&nbsp;已赞&nbsp;(' + v.p_good + ')' : '<span class="fa fa-thumbs-o-up" />&nbsp;赞&nbsp;(' + v.p_good + ')';
								ahtml += '</a><a href="#">' + v.p_time + '</a></p><div class="decoration hide-if-responsive"></div>';
							});
							$('#list').append(ahtml);
							if (page == s.page) {
								$('#more').css('display', 'none');
							}
							page++;

							$('.pickHeart').on('click', function() {

								if (getCookie("userID") == '') {
									alert("请登录后再操作!");
									return;
								}

								if (!confirm("确认摘取?")) {
									return;
								};

								tran = this;
								$.post('Operation.php?oper=pick&heartid=' + $(this).parent().attr('id'), function(s) {
									if (s.error == 'error') {
										return alert(s.mess);
									} else if (s.error == 'ok') {
										alert("摘取成功!这个女生的联系方式为" + s.conn + ",还可以在用户中心里查看。")
										$(tran).html('<span class="fa fa-star" />&nbsp;已摘&nbsp;(' + s.mess + ')');
										return;
									}
								}, 'json');

							});
							$('.goodHeart').on('click', function() {
								tran = this;
								$.post('Operation.php?oper=good&heartid=' + $(this).parent().attr('id'), function(s) {
									if (s.error == 'error') {
										return alert(s.mess);
									} else if (s.error == 'ok') {
										$(tran).html('<span class="fa fa-thumbs-up" />&nbsp;已赞&nbsp;(' + s.mess + ')');
										return;
									}
								}, 'json');
							});
						});
					};

					$('#more a').on('click', function() {
						return loadpage();
					});

					loadpage();

					$('#commentSubmitButton').on('click', function() {

						var kwd = $('#keyword').val();
						if (kwd == '') {
							return alert('请输入您要搜索的关键字！');
						}

						$.post('Operation.php?oper=search&keyword=' + kwd, function(s) {
							if (s.error == 'EmptyPost') {
								return alert('您的关键字为空, 无法搜索!');
							}
							if (s.error == 'ok') {
								$('#more a').text('返回心愿墙').attr('href', 'index.html').off('click');
								$('#more').css('display', 'block');
								$("#search").toggleClass("hide");
								$('#keyword').val('');
								if (s.list.length == 0) {
									return $('#list').html('<p style="margin:10px 0;text-align:center">抱歉，没有找到相关心愿</p>');
								}
								var ahtml = '';
								$.each(s.list, function(k, v) {
									ahtml += '<p class="notification-page-item" id="' + v.p_heartid + '">';
									ahtml += v.p_top == 1 ? '<img class="top" src="images/top.png" alt="top" />' : ' ';
									ahtml += v.p_finish == 1 ? '<img class="done" src="images/done.png" alt="done" />' : ' ';
									ahtml += '<img src="' + 'images/head.jpg' + '" alt="img" /><em>' + v.p_content + '</em><a href="#" class="pickHeart">';
									ahtml += v.isPick == 1 ? '<span class="fa fa-star" />&nbsp;已摘&nbsp;(' + v.p_pick + ')' : '<span class="fa fa-star-o" />&nbsp;摘&nbsp;(' + v.p_pick + ')';
									ahtml += '</a><a href="#" class="goodHeart">';
									ahtml += v.isGood == 1 ? '<span class="fa fa-thumbs-up" />&nbsp;已赞&nbsp;(' + v.p_good + ')' : '<span class="fa fa-thumbs-o-up" />&nbsp;赞&nbsp;(' + v.p_good + ')';
									ahtml += '</a><a href="#">' + v.p_time + '</a></p><div class="decoration hide-if-responsive"></div>';
								});
								$('#list').html(ahtml);
								$('.pickHeart').on('click', function() {

									if (getCookie("userID") == '') {
										alert("请登录后再操作!");
										return;
									}

									if (!confirm("确认摘取?")) {
										return;
									};

									tran = this;
									$.post('Operation.php?oper=pick&heartid=' + $(this).parent().attr('id'), function(s) {
										if (s.error == 'error') {
											return alert(s.mess);
										} else if (s.error == 'ok') {
											alert("摘取成功!这个女生的联系方式为" + s.conn + ",还可以在用户中心里查看。")
											$(tran).html('<span class="fa fa-star" />&nbsp;已摘&nbsp;(' + s.mess + ')');
											return;
										}
									}, 'json');

								});
								$('.goodHeart').on('click', function() {
									tran = this;
									$.post('Operation.php?oper=good&heartid=' + $(this).parent().attr('id'), function(s) {
										if (s.error == 'error') {
											return alert(s.mess);
										} else if (s.error == 'ok') {
											$(tran).html('<span class="fa fa-thumbs-up" />&nbsp;已赞&nbsp;(' + s.mess + ')');
											return;
										}
									}, 'json');
								});
							}
						}, 'json');

					});
				});

			}(jQuery));
		</script>

	</body>

</html>